# Sieger Billing Console 用户手册

## 系统简介

Sieger Billing Console 是一个面向 GCP/AWS/Azure 云服务分销商的企业级账单管理系统。系统支持多云成本归集、客户定价管理、自动发票生成、信用额度管理等功能。

---

## 目录

1. [登录系统](#1-登录系统)
2. [界面概览](#2-界面概览)
3. [仪表盘](#3-仪表盘)
4. [客户管理](#4-客户管理)
5. [项目与账单账户](#5-项目与账单账户)
6. [定价管理](#6-定价管理)
7. [信用额度](#7-信用额度)
8. [特殊规则](#8-特殊规则)
9. [成本数据导入](#9-成本数据导入)
10. [发票生成](#10-发票生成)
11. [发票管理](#11-发票管理)
12. [付款记录](#12-付款记录)
13. [对账](#13-对账)
14. [用户管理](#14-用户管理)
15. [审计日志](#15-审计日志)
16. [个人设置](#16-个人设置)

---

## 1. 登录系统

### 访问地址

打开浏览器，访问系统地址（由管理员提供）。

### 登录步骤

1. 输入您的**邮箱地址**
2. 输入**密码**
3. 点击「继续」按钮

### 语言切换

- 点击右上角的 🌐 图标
- 选择「English」或「中文」

### 主题切换

- 点击右上角的 ☀️/🌙 图标
- 选择亮色、暗色或跟随系统

---

## 2. 界面概览

登录成功后，您将看到主界面：

```
┌─────────────────────────────────────────────────────────┐
│  Sieger                        🌐  ☀️  🔔  👤           │
│  账单控制台                                              │
├──────────────┬──────────────────────────────────────────┤
│              │                                          │
│  仪表盘      │          主内容区域                       │
│  发票        │                                          │
│  设置        │                                          │
│              │                                          │
│  ─────────── │                                          │
│  管理中心    │                                          │
│  客户管理    │                                          │
│  账单账户    │                                          │
│  项目        │                                          │
│  ...         │                                          │
│              │                                          │
├──────────────┴──────────────────────────────────────────┤
│  👤 用户名                                              │
│  user@email.com                                         │
└─────────────────────────────────────────────────────────┘
```

### 左侧导航栏

- **主导航**：仪表盘、发票、设置
- **管理中心**：客户、账单、定价等管理功能（需管理员权限）

### 右上角工具栏

- 🌐 语言切换
- ☀️/🌙 主题切换
- 🔔 通知
- 👤 用户菜单（个人资料、退出登录）

---

## 3. 仪表盘

**路径**：`/dashboard`

仪表盘提供系统整体概览：

### 关键指标卡片

- **本月营收**：当月发票总金额
- **客户数量**：活跃客户总数
- **待处理发票**：草稿状态的发票数
- **待付款金额**：已开票未付款金额

### 图表分析

- **月度趋势**：近 12 个月营收趋势
- **客户分布**：按客户的费用占比
- **产品分布**：按云服务产品的费用占比
- **供应商分布**：GCP/AWS/Azure 费用占比

---

## 4. 客户管理

**路径**：`/admin/customers`

### 客户列表

显示所有客户，包括：
- 客户名称
- 域名
- 状态（活跃/暂停/终止）
- 币种
- 付款条款（天数）

### 创建客户

1. 点击「创建客户」按钮
2. 填写客户信息：
   - **名称**（必填）：客户公司名称
   - **外部 ID**：GCP 客户 ID（可选）
   - **域名**：客户域名
   - **币种**：USD/CNY/EUR 等
   - **付款条款**：付款期限（默认 30 天）
   - **联系人姓名**
   - **联系人邮箱**
3. 点击「保存」

### 查看客户详情

点击客户行进入详情页，可查看和管理：

- **基本信息**：编辑客户资料
- **关联项目**：绑定/解绑 GCP 项目
- **定价列表**：管理客户专属定价
- **信用额度**：管理客户信用
- **特殊规则**：管理计费特殊规则
- **发票历史**：查看历史发票

### 绑定项目到客户

1. 进入客户详情页
2. 切换到「项目」标签
3. 点击「绑定项目」
4. 选择要绑定的 GCP 项目
5. 设置生效日期
6. 点击「确认」

> **重要**：项目必须先绑定到客户，该项目的费用才会计入客户账单。

---

## 5. 项目与账单账户

### 账单账户管理

**路径**：`/admin/billing-accounts`

账单账户对应 GCP Billing Account，系统会自动从导入的成本数据中识别。

### 项目管理

**路径**：`/admin/projects`

项目对应 GCP Project，显示：
- 项目 ID
- 项目名称
- 关联的账单账户
- 状态
- 归属客户

---

## 6. 定价管理

### 产品组管理

**路径**：`/admin/sku-groups`

产品组用于将相似的 SKU 归类，便于统一定价。

#### 创建产品组

1. 点击「创建产品组」
2. 填写：
   - **代码**：唯一标识符（如 `VM-N1-STANDARD`）
   - **名称**：显示名称
   - **描述**：说明
3. 保存后，添加 SKU 映射

#### 添加 SKU 到产品组

1. 进入产品组详情
2. 点击「添加 SKU」
3. 搜索并选择要添加的 SKU
4. 确认添加

### 定价列表管理

**路径**：`/admin/pricing-lists`

每个客户可以有专属的定价列表。

#### 创建定价规则

1. 进入客户详情 → 定价列表标签
2. 点击「添加定价规则」
3. 配置：
   - **产品组**：选择要定价的产品组（留空表示应用于所有产品）
   - **折扣率**：如 0.90 表示 9 折（按标价的 90% 计费）
   - **优先级**：数字越小优先级越高
   - **生效日期**：规则生效的起止日期
4. 保存

#### 定价规则优先级

系统按以下顺序匹配定价规则：
1. 优先级数值（小的优先）
2. 具体产品组优先于通用规则
3. 生效日期范围

---

## 7. 信用额度

**路径**：`/admin/credits`

信用额度用于给客户提供账单抵扣。

### 信用类型

| 类型 | 说明 |
|------|------|
| 促销 (PROMOTION) | 营销推广用途的信用 |
| 合同 (CONTRACT) | 合同约定的承诺信用 |
| 灵活 (FLEX) | 灵活使用的信用 |

### 创建信用额度

1. 点击「创建信用」
2. 填写：
   - **客户**：选择客户
   - **类型**：促销/合同/灵活
   - **总金额**：信用总额
   - **币种**：USD/CNY 等
   - **有效期**：起止日期
   - **允许跨月**：是否可跨月使用
   - **备注**：信用来源说明
3. 保存

### 信用使用

- 信用额度在发票生成时自动应用
- 按有效期和优先级顺序使用
- 信用余额实时更新

---

## 8. 特殊规则

**路径**：`/admin/special-rules`

特殊规则用于处理非标准计费场景。

### 规则类型

| 类型 | 说明 | 使用场景 |
|------|------|----------|
| 排除 SKU | 从账单中排除特定 SKU | 内部测试项目 |
| 排除产品组 | 排除整个产品组 | 免费试用产品 |
| 成本覆盖 | 乘以系数（0=免费） | 合作伙伴优惠 |
| 费用转移 | 将费用转移到其他客户 | 集团内部分摊 |

### 创建特殊规则

1. 点击「创建规则」
2. 配置：
   - **名称**：规则名称
   - **客户**：应用的客户（留空为全局规则）
   - **规则类型**：选择类型
   - **匹配条件**：SKU/产品组/项目/账单账户
   - **生效日期**：起止日期
   - **优先级**：执行顺序
3. 保存

---

## 9. 成本数据导入

**路径**：`/admin/raw-cost-imports`

### 导入流程

1. 点击「导入成本数据」
2. 选择数据来源：
   - **CSV 上传**：上传导出的成本 CSV 文件
   - **BigQuery**：从 GCP BigQuery 直接拉取
3. 选择账单月份
4. 上传/拉取数据
5. 系统自动处理并显示导入结果

### 导入记录

列表显示历史导入记录：
- 导入时间
- 来源
- 账单月份
- 记录数
- 状态

### CSV 格式要求

```csv
billing_account_id,project_id,service_id,sku_id,usage_start_time,usage_end_time,usage_amount,cost,currency,region
billingAccounts/ABC123,my-project,6F81-5844-456A,D123-4567-89AB,2024-01-01T00:00:00Z,2024-01-01T01:00:00Z,1.0,0.05,USD,us-central1
```

---

## 10. 发票生成

**路径**：`/admin/invoice-runs`

### 发票批次概念

发票批次（Invoice Run）是一次批量发票生成操作，系统会：
1. 读取指定月份的成本数据
2. 按客户-项目归集费用
3. 应用定价规则计算价格
4. 应用信用额度抵扣
5. 应用特殊规则
6. 生成发票

### 创建发票批次

1. 点击「创建发票批次」
2. 配置：
   - **账单月份**：选择月份（如 2024-01）
   - **目标客户**：留空为所有客户，或选择特定客户
   - **数据来源**：选择成本数据批次
3. 点击「预览」查看预计结果
4. 确认无误后点击「执行」

### 批次状态

| 状态 | 说明 |
|------|------|
| 排队中 (QUEUED) | 等待执行 |
| 运行中 (RUNNING) | 正在生成发票 |
| 成功 (SUCCEEDED) | 生成完成 |
| 失败 (FAILED) | 生成失败，查看错误详情 |
| 已锁定 (LOCKED) | 发票已锁定，不可修改 |

### 查看批次详情

点击批次行进入详情页，可查看：
- 执行参数
- 生成的发票列表
- 统计汇总
- 错误日志（如有）

---

## 11. 发票管理

**路径**：`/invoices`

### 发票列表

显示所有发票：
- 发票号
- 客户名称
- 账单月份
- 金额
- 状态
- 开票日期
- 到期日期

### 发票状态

| 状态 | 说明 |
|------|------|
| 草稿 (DRAFT) | 可编辑，未正式开票 |
| 已开票 (ISSUED) | 正式开票，等待付款 |
| 已付款 (PAID) | 客户已付款 |
| 已取消 (CANCELLED) | 发票已作废 |
| 已锁定 (LOCKED) | 审计锁定，不可修改 |

### 查看发票详情

点击发票行进入详情页，可查看：

- **基本信息**：发票号、客户、日期等
- **费用明细**：按项目/服务的费用明细
- **信用抵扣**：应用的信用额度
- **合计**：小计、税费、总计

### 导出发票

1. 进入发票详情
2. 点击「导出」按钮
3. 选择格式：
   - **CSV**：表格数据
   - **XLSX**：Excel 格式
   - **PDF**：打印格式
4. 选择汇总级别：
   - 按 SKU 明细
   - 按服务汇总
   - 按项目汇总

### 锁定发票

锁定后的发票不可修改，用于审计合规：

1. 进入发票详情
2. 点击「锁定发票」
3. 确认操作

> **注意**：锁定操作不可撤销。

---

## 12. 付款记录

**路径**：`/admin/payments`

### 记录付款

1. 点击「记录付款」
2. 填写：
   - **发票**：选择发票
   - **付款金额**
   - **付款日期**
   - **付款方式**：电汇/支票/信用卡等
   - **参考号**：银行流水号等
   - **备注**
3. 保存

### 付款状态自动更新

- 付款金额等于发票金额时，发票状态自动变为「已付款」
- 支持分次付款

---

## 13. 对账

**路径**：`/admin/reconciliation`

对账功能用于核对成本数据与发票的一致性。

### 对账报告

选择月份后，系统生成对账报告：

- **成本总额**：原始成本数据合计
- **发票总额**：发票金额合计
- **差异**：两者差额
- **差异明细**：按客户/项目的差异分析

### 差异原因

常见差异原因：
- 项目未绑定客户
- 定价规则变更
- 信用额度抵扣
- 特殊规则调整

---

## 14. 用户管理

**路径**：`/admin/users`

### 用户列表

显示系统用户：
- 姓名
- 邮箱
- 角色
- 状态
- 最后登录时间

### 创建用户

1. 点击「创建用户」
2. 填写：
   - **邮箱**（必填）
   - **姓名**
   - **密码**
   - **角色**：选择一个或多个角色
3. 保存

### 角色说明

| 角色 | 权限 |
|------|------|
| 超级管理员 | 所有权限，可访问所有客户数据 |
| 管理员 | 管理权限，受数据范围限制 |
| 财务 | 发票和付款相关操作 |
| 查看者 | 只读权限 |

### 分配数据范围

对于非超级管理员用户，需要分配可访问的数据范围：

1. 进入用户详情
2. 切换到「数据范围」标签
3. 添加可访问的客户/项目
4. 保存

---

## 15. 审计日志

**路径**：`/admin/audit-logs`

### 日志内容

记录所有系统操作：
- 操作时间
- 操作人
- 操作类型（创建/更新/删除等）
- 操作对象
- 变更前后数据

### 筛选日志

支持按以下条件筛选：
- 时间范围
- 操作类型
- 操作人
- 操作对象类型

---

## 16. 个人设置

**路径**：`/settings`

### 修改密码

1. 进入设置页面
2. 输入当前密码
3. 输入新密码（两次）
4. 点击「修改密码」

### 语言设置

- 点击右上角 🌐 图标切换

### 主题设置

- 点击右上角 ☀️/🌙 图标切换

---

## 典型工作流程

### 月度账单生成流程

```
1. 导入成本数据
   └── /admin/raw-cost-imports → 导入当月 CSV 或同步 BigQuery

2. 检查项目绑定
   └── /admin/projects → 确认所有项目已绑定客户

3. 检查定价规则
   └── /admin/pricing-lists → 确认定价规则正确

4. 创建发票批次
   └── /admin/invoice-runs → 创建并执行

5. 审核发票
   └── /invoices → 检查发票内容

6. 正式开票
   └── /invoices/{id} → 将状态改为「已开票」

7. 导出发票
   └── /invoices/{id} → 导出 PDF 发送客户

8. 记录付款
   └── /admin/payments → 收到付款后记录
```

### 新客户上线流程

```
1. 创建客户
   └── /admin/customers → 创建客户基本信息

2. 绑定项目
   └── /admin/customers/{id} → 项目标签 → 绑定项目

3. 设置定价
   └── /admin/customers/{id} → 定价标签 → 添加定价规则

4. 添加信用（如有）
   └── /admin/credits → 创建信用额度

5. 设置特殊规则（如有）
   └── /admin/special-rules → 创建规则
```

---

## 常见问题

### Q: 发票金额为什么与成本不一致？

可能原因：
1. 应用了定价规则（折扣）
2. 应用了信用额度抵扣
3. 应用了特殊规则
4. 有项目未绑定到客户

请查看发票详情中的费用明细和调整项。

### Q: 如何处理退款？

1. 创建负数金额的信用额度
2. 或在下月发票中手动调整

### Q: 如何修改已开票的发票？

已开票发票不可直接修改。请：
1. 取消原发票
2. 重新生成发票

### Q: 忘记密码怎么办？

请联系系统管理员重置密码。

---

## 技术支持

如遇问题，请联系系统管理员或技术支持团队。
